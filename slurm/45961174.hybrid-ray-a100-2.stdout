[2026-02-24 21:43:43,598][__main__][INFO] - Starting EzSpeech training...
[2026-02-24 21:43:43,603][__main__][INFO] - Configuration:
dataset:
  spe_file: /scratch/midway3/khanhnd/Ezspeech/tokenizer/vi/tokenizer.model
  train_ds:
    _target_: ezspeech.modules.data.dataset.SpeechRecognitionDataset
    filepaths:
    - /scratch/midway3/khanhnd/data/metadata/youtube.jsonl
    data_dir: /scratch/midway3/khanhnd/data/audio/
  val_ds:
    _target_: ezspeech.modules.data.dataset.SpeechRecognitionDataset
    filepaths:
    - /scratch/midway3/khanhnd/data/metadata/hehe.jsonl
    data_dir: /scratch/midway3/khanhnd/data/audio/
  train_loader:
    max_batch_duration: 150
    num_bucket: 20
    num_workers: 8
    pin_memory: true
  val_loader:
    batch_size: 4
    num_workers: 4
    pin_memory: true
model:
  d_model: 512
  vocab_size: 2048
  model_pretrained:
    path: /scratch/midway3/khanhnd/Ezspeech/ezspeech.ckpt
    include:
    - encoder
  preprocessor:
    _target_: ezspeech.modules.data.utils.audio.AudioToMelSpectrogramPreprocessor
    sample_rate: 16000
    normalize: per_feature
    window_size: 0.025
    window_stride: 0.01
    window: hann
    features: 80
    n_fft: 512
    frame_splicing: 1
    dither: 1.0e-05
    pad_to: 0
  spec_augment:
    _target_: ezspeech.modules.data.augment.SpecAugment
    freq_masks: 2
    time_masks: 10
    freq_width: 27
    time_width: 0.05
  encoder:
    _target_: ezspeech.modules.encoder.conformer.ConformerEncoder
    feat_in: ${model.preprocessor.features}
    feat_out: -1
    n_layers: 17
    d_model: 512
    subsampling: dw_striding
    subsampling_factor: 8
    subsampling_conv_channels: 256
    causal_downsampling: false
    reduction: null
    reduction_position: null
    reduction_factor: 1
    ff_expansion_factor: 4
    self_attention_model: rel_pos
    n_heads: 8
    att_context_size:
    - -1
    - -1
    att_context_style: regular
    xscaling: false
    untie_biases: true
    pos_emb_max_len: 5000
    conv_kernel_size: 9
    conv_norm_type: batch_norm
    conv_context_size: null
    dropout: 0.1
    dropout_pre_encoder: 0.1
    dropout_emb: 0.0
    dropout_att: 0.1
    stochastic_depth_drop_prob: 0.0
    stochastic_depth_mode: linear
    stochastic_depth_start_layer: 1
  ctc_decoder:
    _target_: ezspeech.modules.decoder.decoder.ConvASRDecoder
    feat_in: 512
    num_classes: 2048
    add_blank: true
  loss:
    ctc_loss:
      _target_: ezspeech.modules.losses.ctc.CTCLoss
      blank_idx: 2048
      reduction: mean
      zero_infinity: true
  optimizer:
    lr: 1
    betas:
    - 0.9
    - 0.999
    weight_decay: 0.01
    eps: 1.0e-09
    foreach: false
    fused: true
  scheduler:
    d_model: 512
    warmup_steps: 10000
callbacks:
  lr:
    _target_: pytorch_lightning.callbacks.LearningRateMonitor
  swa:
    _target_: pytorch_lightning.callbacks.StochasticWeightAveraging
    swa_lrs: 1.0e-06
    swa_epoch_start: 0.8
    annealing_epochs: 1
  cb:
    _target_: pytorch_lightning.callbacks.ModelCheckpoint
    monitor: step
    save_top_k: 1
    save_last: true
    filename: '{epoch}-{val_wer:.5f}-{step}'
    every_n_epochs: 1
    mode: max
loggers:
  tb:
    _target_: pytorch_lightning.loggers.TensorBoardLogger
    save_dir: /scratch/midway2/khanhnd/lightning_logs
    name: icassp
    default_hp_metric: false
trainer:
  max_epochs: 100
  strategy: ddp
  accelerator: gpu
  devices:
  - 0
  accumulate_grad_batches: 1
  precision: 32
  val_check_interval: 1000
  use_distributed_sampler: false

PADDING: 0
[2026-02-24 21:43:48,854][__main__][INFO] - Pretrained weights loaded successfully.
[2026-02-24 21:43:48,855][__main__][INFO] - Added callback: lr
[2026-02-24 21:43:48,855][__main__][INFO] - Added callback: swa
[2026-02-24 21:43:48,856][__main__][INFO] - Added callback: cb
[2026-02-24 21:43:48,857][__main__][INFO] - Initializing PyTorch Lightning trainer...
[2026-02-24 21:43:48,894][__main__][INFO] - Starting training process...
┏━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┳━━━━━━━┓
┃   ┃ Name         ┃ Type                             ┃ Params ┃ Mode  ┃ FLOPs ┃
┡━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━╇━━━━━━━┩
│ 0 │ preprocessor │ AudioToMelSpectrogramPreprocess… │      0 │ train │     0 │
│ 1 │ spec_augment │ SpecAugment                      │      0 │ train │     0 │
│ 2 │ encoder      │ ConformerEncoder                 │  108 M │ train │     0 │
│ 3 │ ctc_decoder  │ ConvASRDecoder                   │  1.1 M │ train │     0 │
│ 4 │ ctc_loss     │ CTCLoss                          │      0 │ train │     0 │
└───┴──────────────┴──────────────────────────────────┴────────┴───────┴───────┘
Trainable params: 109 M                                                         
Non-trainable params: 0                                                         
Total params: 109 M                                                             
Total estimated model params size (MB): 439                                     
Modules in train mode: 497                                                      
Modules in eval mode: 0                                                         
Total FLOPs: 0                                                                  
['trứng thuật gói ậy câu đói dù ngược vui ể ra mardối', 'phú rễ giấc lãgiấc ục rượu túc trí sự phục mãi àu chúc ể mạng uối độc ớ sớm lãnh ệt tham iểu ùy địa quảng cướp tung tốc tung xung uyền dù cuộc ẽ ưỡgiá phục phút ó chsphổ dù cận ọt chút nghề cuộc õ kinh vâng kinh bề mãi chuyển raướt xâm bình ũiên dù', 'cuộc lãrẻ đói linh biện ụt phật lãngon nở nông hàng kinh tú chưa hoàng vâng video vị nồi sự thổ ãđịa dọn ón đỉnh loại khoa lacấp sâu bếp ngược bếp i iền', 'tốc xương ướt ới ão chồng h ngạc hay dù ịch cháu thúc đói õi dụng bờ tấm muộn rau dù ầu dù hồ ặn chi cấm phiếu ? rễ i giá khoa ậy ẻ đảng tưởng iên phiếu']
['bà diệp', 'để ghi nhận công đức của ông vương gia huy đã cúng một tỷ đồng để trùng tu bản đền', 'đó là hình nhân tượng trưng cho bà thầy và những người hầu', 'mẹ ơi sao ở đây có nhiều búp bê quá vậy']
___________
['huyết ổ ới mẽ đói hứa thiếu đoàn tín câu ra ychồng ướt hoài ưới rượu khoa ytrí phiếu số từng sôi ượnghiệp đói rượu sơ ia áu sơ nông snở dưới bếp từng xung', 'tung sự ười hay ười thường ào i thuận lê i cận ậy ngược tướng bức chút íầbình phục chuyện i phiếu', 'õ hứa iện lãychuyện thật vòng cảm ửa gọi sđói rau kì ớ ồi ngược xung domàn định lượng iễn dưới ương dụng ọt bếp khoa i dù', 'phú ăng ổng dụng dù liiềm sự chuyện ấc giọng vâng mệt chuyện nông ung nhưphức giản sôi yên cấp ngôi']
['tôi cũng xin giới thiệu con nhang mới của đền chúng ta', 'không được đâu đó là đồ cúng', 'tôi xin cảm ơn quý vị đã tới dự buổi hầu thánh hôm nay', 'vậy cho con xin một con chơi được không']
___________
GPU rank 0 handle 520000 samples
